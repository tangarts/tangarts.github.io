
<html>
    <head> 
        <meta charset='utf-8' />
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel= "stylesheet" href="/static/css/style.css" type="text/css">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <!-- KaTex -->
        <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"
      crossorigin="anonymous">

        <title> Sampling: Rejection and Importance </title>
    </head>

    <body>
        <div class="container">
            <header>
                <h1> <a href='/'> tangarts </a> </h1>
                <div id="header_wrap" class="wrapper">
                    <nav id="navbar" >
                        <ul class="list-none" >
                            <li><a href="/about">about</a> &centerdot;</li>
                            <li><a href="/archives.html">archive</a> &centerdot;</li>
                            <li><a href="/now">now</a> &centerdot;</li>
                            <li><a href="mailto:nehemiahcampbell@hotmail.co.uk">contact</a></li>
                        </ul> 

                    </nav>
                </div>

            </header>  
            <main class="wrapper">

                <hr> 


<h1> Sampling: Rejection and Importance </h1>
<div class=date>
        2021-04-25
        | Modified: 2021-04-26

</div>

<article><p>We left the introduction to monte carlo simulations with its limitation of slow convergence.</p>
<p>In this post we will cover Rejection and Importance sampling.</p>
<p>For a density function <span class="math">\(\pi(x)\)</span>, how can we sample from it?</p>
<h2>Rejection Sampling</h2>
<p>The idea is to sample from a distribution <span class="math">\(q\)</span> that contains <span class="math">\(\pi\)</span> for all <span class="math">\(x\)</span>, that is 
<span class="math">\(\pi \leq M \cdot q\)</span> for all <span class="math">\(x\)</span> and a constant <span class="math">\(M\)</span>.
The algorithm is a two step process:</p>
<p><strong>Rejection Sampling</strong></p>
<hr>
<ol>
<li>Sample <span class="math">\(X \sim q\)</span> and sample <span class="math">\(U \sim U[0, 1]\)</span>.</li>
<li>If <span class="math">\(\mathbb P(U &lt; \frac{\pi(X)}{Mq(X)})\)</span><ul>
<li>accept <span class="math">\(X\)</span> as a sample from <span class="math">\(\pi\)</span></li>
<li>otherwise reject <span class="math">\(X\)</span> and repeat the sampling step.</li>
</ul>
</li>
</ol>
<hr>
<p>To show this works we prove:
For any <span class="math">\(a, b \in \mathbb R\)</span>, <span class="math">\(a \leq b\)</span>.
</p>
<div class="math">$$
    \mathbb P(X \in [a, b] \mid X \text{ accepted}) = \int_a^b \pi(x) dx
$$</div>
<p><em>Proof</em>:
</p>
<div class="math">$$
\begin{aligned}
\mathbb P(X \in [a, b] \cap \text{ accepted}) &amp;= \int_a^b \mathbb P(X \text{ accepted} \mid X = x)q(x) dx \\
&amp;= \int_a^b \frac{\pi(X)}{Mq(X)}q(x) dx \\
&amp;= \frac{1}{M} \int_a^b \pi(x) dx  \\
\Rightarrow \mathbb P( X \text{ accepted}) &amp;= \frac{1}{M} 
\end{aligned}
$$</div>
<p>
Using Bayes' theorem
</p>
<div class="math">$$
\begin{aligned}
    \mathbb P(X \in [a, b] \mid X \text{ accepted}) &amp;= \frac{\mathbb P(X \in [a, b] \cap \text{ accepted})}{\mathbb P(X \text{ accepted})} \\
    &amp;= \frac{\frac{1}{M} \int_a^b \pi(x) dx}{\frac{1}{M}} \\
    &amp;= \int_a^b \pi(x) dx  
\end{aligned}
$$</div>
<p>An important consequence of this is the probability until an acceptance <span class="math">\(\mathbb P(X \text{ accepted}) = \frac{1}{M}\)</span> is distributed
geometrically <span class="math">\(Y \sim \text{Geometric}(\frac{1}{M})\)</span>. The mean time until an acceptance is then <span class="math">\(\mathbb E[Y] = M\)</span>.</p>
<h2>Importance sampling</h2>
<p>We want to evaluate integrals in the form: <span class="math">\(\int \varphi(x)\pi(x) dx\)</span> where
<span class="math">\(\pi\)</span> is a probability distribution and <span class="math">\(\varphi(x)\)</span> is a function. Sometimes
<span class="math">\(\pi\)</span> is tricky to evaluate, maybe the integral is intractable. Importance
sampling introduces a proposal distribution <span class="math">\(q\)</span> such that</p>
<div class="math">$$ \{x : \pi(x) &gt; 0\} \subseteq \{x : q(x) &gt; 0\} $$</div>
<p>or alternatively, there exists a constant <span class="math">\(M\)</span> such that <span class="math">\(\pi(x) \leq M \cdot
q(x)\)</span> for all <span class="math">\(x\)</span> which allows us to express our integral as:</p>
<div class="math">$$\begin{aligned}
\mathbb E_{\pi}[\varphi(X)] &amp;= \int \varphi(x)\pi(x) dx \\
&amp;= \int \varphi(x)\frac{\pi(x)}{q(x)}q(x) dx \\
&amp;= \int \varphi(x)w(x)q(x) dx \\
&amp;= \mathbb E_{q}[\varphi(X)w(X)]. \end{aligned}$$</div>
<p>Using the equivalence above, letting <span class="math">\(X_i \overset{i.i.d}\sim q\)</span> and appealing
to the weak law of large numbers we see </p>
<div class="math">$$
    \frac{1}{n} \sum_{i=1}^n \varphi(X_i)w(X_i) \overset{\text{p}}\rightarrow \mathbb E_{\pi}[\varphi(X)]
$$</div>
<p>The algorithm is as follows:</p>
<p><strong>Importance Sampling</strong></p>
<hr>
<p>Choose <span class="math">\(q\)</span> such that <span class="math">\(\{x : \pi(x) &gt; 0\} \subseteq \{x : q(x) &gt; 0\}\)</span>.</p>
<ol>
<li>For <span class="math">\(i = 1, 2, \cdots, n\)</span>:<ul>
<li>Draw <span class="math">\(X_i \sim q\)</span> </li>
<li>Calculate importance weights <span class="math">\(w(X_i) = \frac{\pi(X_i)}{q(X_i)}\)</span></li>
</ul>
</li>
<li>Calculate <span class="math">\(\bar{\varphi}_n = \frac{1}{n}\sum_{i=1}^n \varphi(X_i)w(X_i)\)</span>, 
the unbiased estimator of <span class="math">\(\mathbb E_\pi[\varphi(X)]\)</span>.</li>
</ol>
<hr>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></article>



            </main> 

            <footer>
                <p>&centerdot; &centerdot; &centerdot;</p> 
            </footer>

        </div>
    </body>
</html>
