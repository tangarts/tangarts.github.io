
<html>
    <head> 
        <meta charset='utf-8' />
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel= "stylesheet" href="/static/css/style.css" type="text/css">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <!-- KaTex -->
        <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"
      crossorigin="anonymous">

        <title> Modelling TFL journeys </title>
    </head>

    <body>
        <div class="container">
            <header>
                <h1> <a href='/'> tangarts </a> </h1>
                <div id="header_wrap" class="wrapper">
                    <nav id="navbar" >
                        <ul class="list-none" >
                            <li><a href="/about">about</a> &centerdot;</li>
                            <li><a href="/archives.html">archive</a> &centerdot;</li>
                            <li><a href="/now">now</a> &centerdot;</li>
                            <li><a href="mailto:nehemiahcampbell@hotmail.co.uk">contact</a></li>
                        </ul> 

                    </nav>
                </div>

            </header>  
            <main class="wrapper">

                <hr> 


<h1> Modelling TFL journeys </h1>
<div class=date>
        2021-04-26
        | Modified: 2021-04-29

</div>

<article><h2>Data Description and Background</h2>
<h3><a href="https://data.london.gov.uk/dataset/public-transport-journeys-type-transport">Public Transport Journeys by Type of Transport</a></h3>
<p>The data set comes from the Transport for London website. It describes the number of journeys on the public transport network by TFL reporting period, by type of transport. Data is broken down by bus, underground, DLR, tram, Overground and cable car.</p>
<p>Some information about the dataset from the data description:</p>
<blockquote>
<p>Period lengths are different in periods 1 and 13, and the data is not adjusted to account for that.
   Docklands Light Railway journeys are based on automatic passenger counts at stations.
   Overground and Tram journeys are based on automatic on-carriage passenger counts.
   Reliable Overground journey numbers have only been available since October 2010.</p>
</blockquote>
<p>In this project we will be forecasting the number of journeys on the London Underground network.</p>
<p>We first create a test set the last 5 journey counts on the London Underground network to compare 
with our final forecasts.</p>
<h2>Visualise the time series plot</h2>
<div class="highlight"><pre><span></span><code>## `geom_smooth()` using formula &#39;y ~ x&#39;
</code></pre></div>

<p><img alt="center" src="/images/tfl/unnamed-chunk-3-1.png"></p>
<div class="highlight"><pre><span></span><code>##                  Estimate   Std. Error  t value     Pr(&gt;|t|)
## (Intercept)  4.983828e+03 4.579668e+02 10.88251 1.315793e-19
## period.start 6.840706e-03 6.413333e-04 10.66638 4.340164e-19
</code></pre></div>

<p>From the initial plot, we can see the time series is non-stationary. We also confirm this from
the non-zero linear model regression coefficient.</p>
<p>We also notice seasonal patterns which we will discuss later.</p>
<h2>Stationarity</h2>
<p>After first order differencing we plot the time series, its autocorrelation and partial auto correlation plots. </p>
<p><img alt="center" src="/images/tfl/unnamed-chunk-5-1.png"></p>
<p>From the autocorrelation-lag plot we see high correlation at periodic intervals implying seasonality.</p>
<h2>Seasonality</h2>
<p>From the data we see months with two entries hence correlation every 13 lags. The data description also confirms this:</p>
<blockquote>
<p>Period lengths are different in periods 1 and 13, and the data is not adjusted to account for that.</p>
</blockquote>
<p><img alt="center" src="/images/tfl/unnamed-chunk-6-1.png"></p>
<p>After applying differencing every 13 lags we see a clearer representation of the ACF and
PACF plots. We initially consider <strong>ARIMA(0,1,1)(0,1,1)[13]</strong>.</p>
<div class="highlight"><pre><span></span><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(0,1,1)(0,1,1)[13]
## Q* = 5.4208, df = 8, p-value = 0.7118
## 
## Model df: 2.   Total lags used: 10
</code></pre></div>

<div class="highlight"><pre><span></span><code>## 
## Call:
## arima(x = lu, order = c(0, 1, 1), seasonal = list(order = c(0, 1, 1), period = 13), 
##     method = (&quot;ML&quot;))
## 
## Coefficients:
##           ma1     sma1
##       -0.8258  -0.9033
## s.e.   0.0575   0.2643
## 
## sigma^2 estimated as 16.43:  log likelihood = -314.98,  aic = 635.95
</code></pre></div>

<p>The model summary seems promising, we now check if the model is adequate using Ljung-Box tests for 
<span class="math">\(K = 6\)</span>, 12 and 24</p>
<div class="highlight"><pre><span></span><code>## 
##  Box-Ljung test
## 
## data:  model1$residuals
## X-squared = 1.9491, df = 6, p-value = 0.9243
</code></pre></div>

<div class="highlight"><pre><span></span><code>## 
##  Box-Ljung test
## 
## data:  model1$residuals
## X-squared = 14.991, df = 12, p-value = 0.242
</code></pre></div>

<div class="highlight"><pre><span></span><code>## 
##  Box-Ljung test
## 
## data:  model1$residuals
## X-squared = 28.14, df = 24, p-value = 0.2542
</code></pre></div>

<p>From the Ljung-Box tests, we can conclude the model is adequate up to lag 24.</p>
<h2>Overdifferencing</h2>
<p>We now try to overfit the model. We start by increasing the degree of the seasonal moving average part to 4. 
Assuming quarterly seasonal variation.</p>
<div class="highlight"><pre><span></span><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(0,1,1)(0,1,4)[13]
## Q* = 5.4319, df = 5, p-value = 0.3655
## 
## Model df: 5.   Total lags used: 10
</code></pre></div>

<div class="highlight"><pre><span></span><code>## 
## Call:
## arima(x = ts(lu), order = c(0, 1, 1), seasonal = list(order = c(0, 1, 4), period = 13), 
##     method = (&quot;ML&quot;))
## 
## Coefficients:
##           ma1     sma1     sma2     sma3    sma4
##       -0.8087  -0.8449  -0.0553  -0.2369  0.2667
## s.e.   0.0634   0.3447   0.1598   0.1669  0.1404
## 
## sigma^2 estimated as 14.78:  log likelihood = -311.11,  aic = 634.21
</code></pre></div>

<p>A decrease in AIC by 1.74, decrease in log likelihood by 3.87 suggesting this model is a
better fit to our data.</p>
<p>We now consider <strong>ARIMA(0,1,2)(1,1,4)[13].</strong></p>
<div class="highlight"><pre><span></span><code>## 
##  Ljung-Box test
## 
## data:  Residuals from ARIMA(0,1,2)(0,1,4)[13]
## Q* = 5.676, df = 4, p-value = 0.2247
## 
## Model df: 6.   Total lags used: 10
</code></pre></div>

<div class="highlight"><pre><span></span><code>## 
## Call:
## arima(x = lu, order = c(0, 1, 2), seasonal = list(order = c(0, 1, 4), period = 13), 
##     method = (&quot;ML&quot;))
## 
## Coefficients:
##           ma1      ma2     sma1     sma2     sma3    sma4
##       -0.7609  -0.0592  -0.8321  -0.0662  -0.2256  0.2670
## s.e.   0.1020   0.1022   0.2908   0.1589   0.1660  0.1458
## 
## sigma^2 estimated as 14.85:  log likelihood = -310.94,  aic = 635.87
</code></pre></div>

<p>No improvement in the reduction of the log likelihood or AIC. </p>
<p>The AIC is slightly higher compared to <strong>ARIMA(0,1,1)(0,1,4)[13]</strong>.</p>
<p>We conclude that <strong>ARIMA(0,1,1)(0,1,4)[13]</strong> is the best fitted model to the data.</p>
<h2>Forecasting</h2>
<p><img alt="center" src="/images/tfl/unnamed-chunk-11-1.png"></p>
<p>Comparing with the test data we see all points lie close to the point forecast.</p>
<h2>Conclusion</h2>
<p>From the analysis, we can see the yearly growth of the London Underground
network usage.</p>
<p>We note there is seasonal effects of the number of journeys on the London
Underground network each year.</p>
<p>We first fit the data to an <strong>ARIMA(0,1,1)(0,1,1)[13]</strong> and after
overdifferencing concluded that a <strong>ARIMA(0,1,1)(0,1,4)[13]</strong> was more
suitable.</p>
<p>We then forecasted the next 5 months resulting in accurate forecasts. 
All of which lie in the 80% forecast interval.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></article>



            </main> 

            <footer>
                <p>&centerdot; &centerdot; &centerdot;</p> 
            </footer>

        </div>
    </body>
</html>
